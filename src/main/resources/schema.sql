DROP  TABLE IF EXISTS users , requests, items, bookings, comments CASCADE;


CREATE TABLE IF NOT EXISTS users (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  name VARCHAR(255) NOT NULL,
  email VARCHAR(512) NOT NULL,
  CONSTRAINT pk_user PRIMARY KEY (id),
  CONSTRAINT UQ_USER_EMAIL UNIQUE (email)
);

CREATE TABLE IF NOT EXISTS requests (
    id int GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
    description VARCHAR(50) ,
    requestor int references users(id),
    created TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    CONSTRAINT FK_REQUEST_ON_REQUESTER FOREIGN KEY (id) REFERENCES users (id)
);

CREATE TABLE IF NOT EXISTS items (
   id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
   name VARCHAR(100),
   description VARCHAR(1000),
   available BOOLEAN DEFAULT FALSE,
   owner_id int REFERENCES users(id),
   request_id int REFERENCES requests(id)
);

CREATE TABLE IF NOT EXISTS bookings(
    id int GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY ,
    start_time TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    end_time TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    item_id int REFERENCES items(id),
    booker_id int  REFERENCES users(id),
    status VARCHAR(100) DEFAULT 'WAITING'
);

CREATE TABLE IF NOT EXISTS comments(
   id int GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY ,
   text VARCHAR(1000),
   item_id int REFERENCES items(id),
   author_id int  REFERENCES users(id),
   created TIMESTAMP WITHOUT TIME ZONE NOT NULL
);

SELECT * FROM items;
SELECT * FROM users;
SELECT * FROM bookings;
SELECT * FROM comments;
